# 机械臂控制系统 - 完整功能框图及程序流程图

## 系统架构流程图

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              系统整体架构流程图                                           │
└─────────────────────────────────────────────────────────────────────────────────────────┘


    ┌───────────────────────────────────────────────────────────────────────────────┐
    │                           OH开发板 (OpenHarmony)                               │
    │  ┌─────────────────────────────────────────────────────────────────────────┐  │
    │  │                                                                         │  │
    │  │   ┌─────────────────────────┐         ┌─────────────────────────┐      │  │
    │  │   │                         │         │                         │      │  │
    │  │   │      鸿蒙应用 (前端)     │         │     Flask后端服务       │      │  │
    │  │   │                         │         │                         │      │  │
    │  │   │   ┌─────────────────┐   │         │   ┌─────────────────┐   │      │  │
    │  │   │   │  用户界面 UI    │   │         │   │  netService.py  │   │      │  │
    │  │   │   │  • 关节控制     │   │         │   │  • 路由处理     │   │      │  │
    │  │   │   │  • 传送带控制   │   │  HTTP   │   │  • 指令编码     │   │      │  │
    │  │   │   │  • 搬运控制     │   │ ──────► │   │  • 状态管理     │   │      │  │
    │  │   │   │  • 动作录制     │   │  POST   │   │  • 线程控制     │   │      │  │
    │  │   │   │  • 状态显示     │   │  :5000  │   │                 │   │      │  │
    │  │   │   └─────────────────┘   │         │   └────────┬────────┘   │      │  │
    │  │   │                         │         │            │            │      │  │
    │  │   │   ┌─────────────────┐   │         │            │            │      │  │
    │  │   │   │  index.js       │   │  JSON   │            │            │      │  │
    │  │   │   │  index.html     │   │ ◄────── │            │            │      │  │
    │  │   │   │  index.css      │   │  响应   │            │            │      │  │
    │  │   │   └─────────────────┘   │         │            │            │      │  │
    │  │   │                         │         │            │            │      │  │
    │  │   └─────────────────────────┘         └────────────┼────────────┘      │  │
    │  │                                                    │                   │  │
    │  └────────────────────────────────────────────────────┼───────────────────┘  │
    │                                                       │                      │
    └───────────────────────────────────────────────────────┼──────────────────────┘
                                                            │
                                                            │  Modbus TCP
                                                            │  192.168.1.103:502
                                                            │
                                                            │  ┌─────────────────┐
                                                            │  │ 写寄存器指令    │
                                                            │  │ (功能码: 06)    │
                                                            ▼  └─────────────────┘
    ┌───────────────────────────────────────────────────────────────────────────────┐
    │                               电脑 (PC)                                        │
    │  ┌─────────────────────────────────────────────────────────────────────────┐  │
    │  │                                                                         │  │
    │  │                          虚拟工厂仿真软件                                │  │
    │  │                                                                         │  │
    │  │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │  │
    │  │   │             │  │             │  │             │  │             │   │  │
    │  │   │  6轴机械臂  │  │  传送带 x2  │  │  颜色传感器 │  │  LED数码管  │   │  │
    │  │   │             │  │             │  │             │  │             │   │  │
    │  │   │  Slave: 1   │  │  Addr: 7,8  │  │  Addr: 14   │  │  Slave: 4   │   │  │
    │  │   │  Addr: 0-6  │  │             │  │             │  │  Addr: 0-2  │   │  │
    │  │   │             │  │             │  │             │  │             │   │  │
    │  │   └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │  │
    │  │                                                                         │  │
    │  │                        ▲  接收指令并执行仿真动作                         │  │
    │  │                                                                         │  │
    │  └─────────────────────────────────────────────────────────────────────────┘  │
    │                                                                               │
    └───────────────────────────────────────────────────────────────────────────────┘


                              ┌─────────────────────────┐
                              │       通信流程说明       │
                              └─────────────────────────┘

    ┌──────────┐          ┌──────────┐          ┌──────────────────┐
    │          │   HTTP   │          │  Modbus  │                  │
    │  前端    │ ───────► │  后端    │ ───────► │    虚拟工厂       │
    │  (鸿蒙)  │   POST   │ (Flask)  │   TCP    │    (PC仿真)      │
    │          │          │          │          │                  │
    └──────────┘          └──────────┘          └──────────────────┘
         │                     │                       │
         │  1.用户点击按钮     │  2.解析请求           │  3.执行动作
         │  发送HTTP请求      │  编码为Modbus指令     │  机械臂运动
         │                     │  通过TCP发送          │  传送带转动
         ▼                     ▼                       ▼
    ┌──────────┐          ┌──────────┐          ┌──────────────────┐
    │ 用户操作 │          │ 指令处理 │          │   仿真执行       │
    │ • 选关节 │          │ • 路由   │          │   • 机械臂控制   │
    │ • 选方向 │          │ • 编码   │          │   • 传送带控制   │
    │ • 选角度 │          │ • 发送   │          │   • 颜色识别     │
    │ • 确认   │          │ • 响应   │          │   • LED显示      │
    └──────────┘          └──────────┘          └──────────────────┘
```

## 〇、程序总体流程图

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                   程序总体流程图                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘

                                    ┌───────────────┐
                                    │   系统启动     │
                                    └───────┬───────┘
                                            │
                    ┌───────────────────────┼───────────────────────┐
                    │                       │                       │
                    ▼                       ▼                       ▼
        ┌───────────────────┐   ┌───────────────────┐   ┌───────────────────┐
        │   初始化日志系统   │   │  初始化Flask应用  │   │ 建立Modbus TCP连接│
        │ pythonapp.log     │   │   端口: 5000      │   │ 192.168.1.103:502 │
        └───────────────────┘   └───────────────────┘   └───────────────────┘
                    │                       │                       │
                    └───────────────────────┼───────────────────────┘
                                            │
                                            ▼
                              ┌─────────────────────────┐
                              │   启动Web服务器监听     │
                              │   host: 0.0.0.0:5000   │
                              └───────────┬─────────────┘
                                          │
                                          ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                     主事件循环                                           │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│  │                              等待HTTP请求                                        │   │
│  └─────────────────────────────────────┬───────────────────────────────────────────┘   │
│                                        │                                               │
│                                        ▼                                               │
│                         ┌──────────────────────────────┐                               │
│                         │        接收并解析请求         │                               │
│                         └──────────────┬───────────────┘                               │
│                                        │                                               │
│    ┌───────────┬───────────┬──────────┼──────────┬───────────┬───────────┐            │
│    │           │           │          │          │           │           │            │
│    ▼           ▼           ▼          ▼          ▼           ▼           ▼            │
│ ┌──────┐  ┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐           │
│ │/send │  │/reset│   │/pump │   │/start│   │/start│   │/pause│   │/Soft │           │
│ │      │  │      │   │/pump2│   │_trans│   │_record   │_trans│   │Reset │           │
│ │手动  │  │复位  │   │      │   │port  │   │/end_ │   │port  │   │      │           │
│ │控制  │  │      │   │传送带│   │      │   │record│   │      │   │软复位│           │
│ └──┬───┘  └──┬───┘   └──┬───┘   └──┬───┘   └──┬───┘   └──┬───┘   └──┬───┘           │
│    │         │          │          │          │          │          │               │
│    ▼         ▼          ▼          ▼          ▼          ▼          ▼               │
│ ┌─────────────────────────────────────────────────────────────────────────────┐     │
│ │                           业务逻辑处理层                                     │     │
│ ├─────────────────────────────────────────────────────────────────────────────┤     │
│ │                                                                             │     │
│ │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │     │
│ │  │ 参数解析    │  │ 指令编码    │  │ 状态管理    │  │ 线程控制    │        │     │
│ │  │ JSON数据    │  │ 命令映射    │  │ 录制/暂停   │  │ 后台搬运    │        │     │
│ │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘        │     │
│ │                                                                             │     │
│ └───────────────────────────────────┬─────────────────────────────────────────┘     │
│                                     │                                               │
│                                     ▼                                               │
│ ┌─────────────────────────────────────────────────────────────────────────────┐     │
│ │                         Modbus TCP 通信层                                    │     │
│ ├─────────────────────────────────────────────────────────────────────────────┤     │
│ │                                                                             │     │
│ │  ┌───────────────────┐        ┌───────────────────┐                        │     │
│ │  │ WRITE_SINGLE_     │        │ READ_HOLDING_     │                        │     │
│ │  │ REGISTER (06)     │        │ REGISTERS (03)    │                        │     │
│ │  │ 写入控制指令       │        │ 读取传感器数据    │                        │     │
│ │  └─────────┬─────────┘        └─────────┬─────────┘                        │     │
│ │            │                            │                                   │     │
│ │            └────────────┬───────────────┘                                   │     │
│ │                         │                                                   │     │
│ └─────────────────────────┼───────────────────────────────────────────────────┘     │
│                           │                                                         │
│                           ▼                                                         │
│ ┌─────────────────────────────────────────────────────────────────────────────┐     │
│ │                              硬件设备层                                      │     │
│ ├─────────────────────────────────────────────────────────────────────────────┤     │
│ │                                                                             │     │
│ │   ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐         │     │
│ │   │ 6轴     │  │ 1号     │  │ 2号     │  │ 颜色    │  │ LED     │         │     │
│ │   │ 机械臂  │  │ 传送带  │  │ 传送带  │  │ 传感器  │  │ 数码管  │         │     │
│ │   │Slave:1  │  │Addr:7   │  │Addr:8   │  │Addr:14  │  │Slave:4  │         │     │
│ │   │Addr:0-6 │  │         │  │         │  │         │  │Addr:0-2 │         │     │
│ │   └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘         │     │
│ │                                                                             │     │
│ └─────────────────────────────────────────────────────────────────────────────┘     │
│                                     │                                               │
│                                     ▼                                               │
│                         ┌───────────────────────┐                                   │
│                         │    返回JSON响应       │                                   │
│                         │ {status, response}   │                                   │
│                         └───────────┬───────────┘                                   │
│                                     │                                               │
│                                     └─────────────────► 返回主循环继续等待请求        │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘


                            ┌─────────────────────────────┐
                            │       自动搬运子流程         │
                            │    (后台线程 do_transport)   │
                            └──────────────┬──────────────┘
                                           │
                                           ▼
                            ┌─────────────────────────────┐
                            │     初始化搬运参数          │
                            │  num, count_box, red_box    │
                            └──────────────┬──────────────┘
                                           │
                                           ▼
                      ┌────────────────────┴────────────────────┐
                      │            while(num > 0)               │
                      └────────────────────┬────────────────────┘
                                           │
                         ┌─────────────────┴─────────────────┐
                         │          检查暂停状态              │
                         │       transport_paused?           │
                         └─────────────────┬─────────────────┘
                                  是│              │否
                                    ▼              │
                         ┌─────────────────┐       │
                         │  等待暂停解除   │       │
                         │  time.sleep     │       │
                         └────────┬────────┘       │
                                  └────────────────┤
                                                   ▼
                         ┌─────────────────────────────────────┐
                         │         更新LED数码管显示           │
                         │      显示当前搬运进度               │
                         └─────────────────┬───────────────────┘
                                           │
                                           ▼
                         ┌─────────────────────────────────────┐
                         │      执行auto_instructions指令      │
                         │   (预设的搬运动作序列)              │
                         └─────────────────┬───────────────────┘
                                           │
                         ┌─────────────────┴─────────────────┐
                         │        指令类型判断                │
                         └─────────────────┬─────────────────┘
                              普通│                │颜色识别
                              指令│                │(addr=14)
                                  ▼                ▼
                  ┌─────────────────────┐  ┌─────────────────────┐
                  │ 发送Modbus写指令    │  │ 循环读取颜色传感器   │
                  │ 控制机械臂/传送带   │  │ 直到检测到物体       │
                  └─────────┬───────────┘  └─────────┬───────────┘
                            │                        │
                            │                ┌───────┴───────┐
                            │                │  颜色=红色?    │
                            │                └───────┬───────┘
                            │                   是│      │否
                            │                     ▼      │
                            │              ┌──────────┐  │
                            │              │red_box++ │  │
                            │              └────┬─────┘  │
                            │                   └────────┤
                            └────────────────────────────┤
                                                         ▼
                         ┌─────────────────────────────────────┐
                         │           执行吸盘操作              │
                         │      吸取 → 移动 → 放置            │
                         └─────────────────┬───────────────────┘
                                           │
                                           ▼
                         ┌─────────────────────────────────────┐
                         │         机械臂复位                  │
                         │       回到初始位置                  │
                         └─────────────────┬───────────────────┘
                                           │
                                           ▼
                         ┌─────────────────────────────────────┐
                         │   num--; count_box++               │
                         │   更新transport_result             │
                         └─────────────────┬───────────────────┘
                                           │
                                           ▼
                              ┌────────────┴────────────┐
                              │       num > 0 ?         │
                              └────────────┬────────────┘
                                    是│          │否
                                      │          ▼
                                      │    ┌───────────────┐
                                      │    │  搬运完成     │
                                      │    │ 更新最终状态  │
                                      │    └───────────────┘
                                      │
                                      └──────► 继续循环
```

## 一、系统功能框图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              机械臂控制系统                                       │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────┐         HTTP/REST API        ┌─────────────────────┐  │
│  │                     │◄─────────────────────────────►│                     │  │
│  │   前端控制界面       │                               │   Flask后端服务     │  │
│  │   (HarmonyOS)       │                               │   (Python)          │  │
│  │                     │                               │                     │  │
│  └─────────────────────┘                               └──────────┬──────────┘  │
│           │                                                       │             │
│           │                                                       │             │
│           ▼                                                       ▼             │
│  ┌─────────────────────┐                               ┌─────────────────────┐  │
│  │   用户交互模块       │                               │   Modbus TCP通信    │  │
│  │  ┌───────────────┐  │                               │   (192.168.1.103)   │  │
│  │  │ 关节选择      │  │                               └──────────┬──────────┘  │
│  │  │ 方向选择      │  │                                          │             │
│  │  │ 角度选择      │  │                                          ▼             │
│  │  │ 传送带控制    │  │                               ┌─────────────────────┐  │
│  │  │ 搬运控制      │  │                               │   硬件设备层         │  │
│  │  │ 动作录制/回放 │  │                               │  ┌───────────────┐  │  │
│  │  └───────────────┘  │                               │  │ 6轴机械臂     │  │  │
│  └─────────────────────┘                               │  │ 1号传送带     │  │  │
│                                                        │  │ 2号传送带     │  │  │
│                                                        │  │ 颜色传感器    │  │  │
│                                                        │  │ LED数码管     │  │  │
│                                                        │  │ 吸盘装置      │  │  │
│                                                        │  └───────────────┘  │  │
│                                                        └─────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 二、模块功能说明

```
┌───────────────────────────────────────────────────────────────────────────────┐
│                              功能模块结构                                      │
├───────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐           │
│  │  手动控制模块    │    │  自动搬运模块    │    │  动作录制模块    │           │
│  ├─────────────────┤    ├─────────────────┤    ├─────────────────┤           │
│  │ /send           │    │ /start_transport│    │ /start_record   │           │
│  │ • 6关节控制     │    │ • 自动搬运流程  │    │ • 开始录制      │           │
│  │ • 正/反向旋转   │    │ • 颜色识别      │    │ /end_record     │           │
│  │ • 1°/2°/3°/5°  │    │ • 红色计数      │    │ • 结束录制      │           │
│  │                 │    │ • 循环搬运      │    │ /start_action   │           │
│  │ /reset          │    │                 │    │ • 执行录制动作  │           │
│  │ • 复位操作      │    │ /pause_transport│    │                 │           │
│  │                 │    │ • 暂停/继续     │    │                 │           │
│  │ /SoftReset      │    │                 │    │                 │           │
│  │ • 软复位        │    │ /get_transport  │    │                 │           │
│  │                 │    │   _status       │    │                 │           │
│  │                 │    │ • 获取搬运状态  │    │                 │           │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘           │
│                                                                               │
│  ┌─────────────────┐    ┌─────────────────┐                                  │
│  │  传送带控制模块  │    │  显示控制模块    │                                  │
│  ├─────────────────┤    ├─────────────────┤                                  │
│  │ /pump           │    │ /change_Led     │                                  │
│  │ • 1号传送带     │    │ • LED数码管显示 │                                  │
│  │ • 开启/关闭     │    │ • 显示搬运数量  │                                  │
│  │                 │    │                 │                                  │
│  │ /pump2          │    │                 │                                  │
│  │ • 2号传送带     │    │                 │                                  │
│  │ • 开启/关闭     │    │                 │                                  │
│  └─────────────────┘    └─────────────────┘                                  │
│                                                                               │
└───────────────────────────────────────────────────────────────────────────────┘
```

## 三、主程序流程图

```
                    ┌─────────────────┐
                    │     程序启动     │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │  初始化日志配置  │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │ 建立Modbus TCP  │
                    │ 连接(192.168.1  │
                    │ .103:502)       │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │ 初始化Flask应用  │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │ 启动Web服务器   │
                    │ (0.0.0.0:5000)  │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │   等待请求      │◄──────────┐
                    └────────┬────────┘           │
                             │                    │
                             ▼                    │
                    ┌─────────────────┐           │
                    │   接收HTTP请求   │           │
                    └────────┬────────┘           │
                             │                    │
                             ▼                    │
            ┌────────────────┴────────────────┐   │
            │           路由分发               │   │
            └────────────────┬────────────────┘   │
                             │                    │
       ┌──────────┬──────────┼──────────┬────────┤
       ▼          ▼          ▼          ▼        │
   ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐      │
   │ /send │ │/start │ │ /pump │ │ /reset│      │
   │       │ │_trans │ │/pump2 │ │       │      │
   │       │ │ port  │ │       │ │       │      │
   └───┬───┘ └───┬───┘ └───┬───┘ └───┬───┘      │
       │         │         │         │          │
       ▼         ▼         ▼         ▼          │
   ┌─────────────────────────────────────┐      │
   │     执行Modbus TCP指令               │      │
   └─────────────────────────────────────┘      │
                             │                  │
                             ▼                  │
                    ┌─────────────────┐         │
                    │   返回JSON响应   │─────────┘
                    └─────────────────┘
```

## 四、手动控制流程图 (/send)

```
                    ┌─────────────────┐
                    │  接收控制请求    │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │ 解析JSON数据    │
                    │ • jointIndex    │
                    │ • direction     │
                    │ • degree        │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │ 计算复位角度    │
                    │ reset_degree =  │
                    │ (cmd+4)%8       │
                    └────────┬────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │ 保存复位指令    │
                    │ reset_          │
                    │ instructions[]  │
                    └────────┬────────┘
                             │
                             ▼
              ┌──────────────┴──────────────┐
              │      是否在录制模式?         │
              └──────────────┬──────────────┘
                 是│                  │否
                   ▼                  │
          ┌─────────────────┐         │
          │ 保存到          │         │
          │ instructions[]  │         │
          └────────┬────────┘         │
                   └──────────────────┤
                                      ▼
                    ┌─────────────────┐
                    │ 执行Modbus指令  │
                    │ WRITE_SINGLE_   │
                    │ REGISTER        │
                    └────────┬────────┘
                             │
                             ▼
              ┌──────────────┴──────────────┐
              │        执行成功?            │
              └──────────────┬──────────────┘
                 是│                  │否
                   ▼                  ▼
          ┌─────────────┐    ┌─────────────┐
          │ 返回成功    │    │ 记录错误日志│
          │ JSON响应    │    │ 返回错误响应│
          └─────────────┘    └─────────────┘
```

## 五、动作录制与回放流程图

```
┌─────────────────────────────────────────────────────────────────┐
│                        录制流程                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────┐    ┌───────────┐    ┌───────────┐               │
│  │开始录制   │───►│清空指令集 │───►│record=True│               │
│  │/start_    │    │instructio │    │           │               │
│  │record     │    │ns.clear() │    │           │               │
│  └───────────┘    └───────────┘    └─────┬─────┘               │
│                                          │                      │
│                                          ▼                      │
│                                   ┌───────────┐                 │
│                                   │ 用户操作  │                 │
│                                   │ 机械臂    │◄────┐          │
│                                   └─────┬─────┘     │           │
│                                         │           │           │
│                                         ▼           │           │
│                                   ┌───────────┐     │           │
│                                   │保存到     │     │           │
│                                   │instructio │─────┘           │
│                                   │ns[]       │                 │
│                                   └─────┬─────┘                 │
│                                         │                       │
│                                         ▼                       │
│  ┌───────────┐                   ┌───────────┐                 │
│  │结束录制   │◄──────────────────│record=    │                 │
│  │/end_record│                   │False      │                 │
│  └───────────┘                   └───────────┘                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                        回放流程                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────┐                                                  │
│  │执行录制   │                                                  │
│  │/start_    │                                                  │
│  │action     │                                                  │
│  └─────┬─────┘                                                  │
│        │                                                        │
│        ▼                                                        │
│  ┌───────────────────────────┐                                 │
│  │    先执行复位操作         │                                 │
│  │ for instruction in        │                                 │
│  │    instructions:          │                                 │
│  │   execute(反向角度)       │                                 │
│  └───────────┬───────────────┘                                 │
│              │                                                  │
│              ▼                                                  │
│  ┌───────────────────────────┐                                 │
│  │   for i in range(num):    │◄─────┐                          │
│  │  (重复执行num次)          │      │                          │
│  └───────────┬───────────────┘      │                          │
│              │                      │                          │
│              ▼                      │                          │
│  ┌───────────────────────────┐      │                          │
│  │ for instruction in        │      │                          │
│  │    instructions:          │      │                          │
│  │   execute(instruction)    │      │                          │
│  └───────────┬───────────────┘      │                          │
│              │                      │                          │
│              ▼                      │                          │
│        ┌─────┴─────┐                │                          │
│        │ i < num ? │────是──────────┘                          │
│        └─────┬─────┘                                           │
│              │否                                                │
│              ▼                                                  │
│  ┌───────────────────────────┐                                 │
│  │       返回响应            │                                 │
│  └───────────────────────────┘                                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 六、系统通信架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              系统通信架构                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────┐                      ┌─────────────────┐             │
│   │  HarmonyOS设备   │                      │   Flask服务器    │             │
│   │                 │    HTTP POST/GET     │   (Python)       │             │
│   │  ┌───────────┐  │◄───────────────────►│                  │             │
│   │  │ index.js  │  │   localhost:5000     │  ┌────────────┐  │             │
│   │  └───────────┘  │                      │  │netService  │  │             │
│   │  ┌───────────┐  │                      │  │   .py      │  │             │
│   │  │index.html │  │                      │  └────────────┘  │             │
│   │  └───────────┘  │                      │                  │             │
│   └─────────────────┘                      └────────┬────────┘             │
│                                                     │                       │
│                                                     │ Modbus TCP            │
│                                                     │ Port: 502             │
│                                                     │                       │
│                                                     ▼                       │
│   ┌─────────────────────────────────────────────────────────────────┐      │
│   │                    Modbus TCP 设备网络 (192.168.1.103)           │      │
│   ├─────────────────────────────────────────────────────────────────┤      │
│   │                                                                 │      │
│   │  ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐        │      │
│   │  │ Slave 1 │   │ Slave 4 │   │颜色传感器│   │其他设备 │        │      │
│   │  │ 机械臂  │   │LED数码管│   │ Addr:14 │   │         │        │      │
│   │  ├─────────┤   ├─────────┤   └─────────┘   └─────────┘        │      │
│   │  │Addr 0-6:│   │Addr 0:  │                                     │      │
│   │  │关节控制 │   │十位显示 │                                     │      │
│   │  │Addr 7:  │   │Addr 1:  │                                     │      │
│   │  │1号传送带│   │个位显示 │                                     │      │
│   │  │Addr 8:  │   │Addr 2:  │                                     │      │
│   │  │2号传送带│   │显示开关 │                                     │      │
│   │  └─────────┘   └─────────┘                                     │      │
│   │                                                                 │      │
│   └─────────────────────────────────────────────────────────────────┘      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 七、命令编码对照表

| 命令名称 | 编码值 | 说明 |
|---------|-------|------|
| forward1 | 1 | 正向旋转1° |
| forward2 | 2 | 正向旋转2° |
| forward3 | 3 | 正向旋转3° |
| forward5 | 4 | 正向旋转5° |
| backward1 | 5 | 反向旋转1° |
| backward2 | 6 | 反向旋转2° |
| backward3 | 7 | 反向旋转3° |
| backward5 | 8 | 反向旋转5° |

## 八、API接口列表

| 接口路径 | 方法 | 功能描述 |
|---------|------|---------|
| /send | POST | 手动控制机械臂关节 |
| /reset | POST | 复位到初始位置 |
| /SoftReset | POST | 软复位(回退一步) |
| /pump | POST | 控制1号传送带 |
| /pump2 | POST | 控制2号传送带 |
| /start_transport | POST | 启动自动搬运 |
| /pause_transport | POST | 暂停/继续搬运 |
| /get_transport_status | GET | 获取搬运状态 |
| /change_Led | POST | 更改LED显示数字 |
| /start_record | POST | 开始录制动作 |
| /end_record | POST | 结束录制动作 |
| /start_action | POST | 执行录制的动作 |

## 九、前端界面功能模块图

```
┌─────────────────────────────────────────────────────────────────┐
│                        前端界面结构                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌────────────────────── 状态显示区 ──────────────────────┐    │
│  │  [red_box: X]          [all_box: X]          [退出]    │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ┌────────────────────── 传送带控制区 ────────────────────┐    │
│  │  [复位]  [开启/关闭1号传送带]  [开启/关闭2号传送带]     │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ┌────────────────────── 关节控制区 ──────────────────────┐    │
│  │  [关节选择▼]  [方向选择▼]  [角度选择▼]  [确认]        │    │
│  │   1-6号关节    正向/反向    1°/2°/3°/5°                │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ┌────────────────────── 搬运控制区 ──────────────────────┐    │
│  │  [-]  [搬运数量: X]  [+]  [开始搬运]  [暂停]  [软复位] │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ┌────────────────────── 动作录制区 ──────────────────────┐    │
│  │  [开启/关闭录制]  [-]  [执行次数: X]  [+]  [执行]      │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```